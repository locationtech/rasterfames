<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="RasterFrames brings the power of Spark DataFrames to geospatial raster data.">
<meta name="generator" content="Paradox, paradox-material-theme=0.6.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="RasterFrames brings the power of Spark DataFrames to geospatial raster data.">
<link rel="shortcut icon" href="assets/images/RasterFrames_32x32.ico">
<title>NoData Handling Â· RasterFrames</title>
<link rel="stylesheet" href="assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="assets/stylesheets/application-palette.22915126.css">
<meta name="theme-color" content="#546e7a" />
<link rel="stylesheet" href="lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="lib/prettify/prettify.css">
<script src="assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="assets/fonts/font-awesome.css">
<link rel="stylesheet" href="assets/fonts/material-icons.css">
<link rel="stylesheet" href="assets/stylesheets/paradox-material-theme.css">
<link rel="stylesheet" href="assets/custom.css">
</head>
<body
data-md-color-primary="blue-grey"
data-md-color-accent="light-blue"
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="index.html" title="RasterFrames" class="md-header-nav__button md-logo">
<img src="assets/images/RF-R.svg" width="24" height="24">
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
RasterFrames
</span>
<span class="md-header-nav__topic">
NoData Handling
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/locationtech/rasterframes"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
locationtech/rasterframes
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="index.html" title="RasterFrames" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<img src="assets/images/RF-R.svg" width="24" height="24">
</a>
<a href="index.html" title="RasterFrames">
RasterFrames
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/locationtech/rasterframes"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
locationtech/rasterframes
</div>
</a>

</div>
<ul>
  <li><a href="description.html" class="page">Overview</a></li>
  <li><a href="getting-started.html" class="page">Getting Started</a></li>
  <li><a href="concepts.html" class="page">Concepts</a></li>
  <li><a href="raster-io.html" class="page">Raster Data I/O</a>
  <ul>
    <li><a href="raster-catalogs.html" class="page">Raster Catalogs</a></li>
    <li><a href="raster-read.html" class="page">Reading Raster Data</a></li>
    <li><a href="raster-write.html" class="page">Writing Raster Data</a></li>
  </ul></li>
  <li><a href="vector-data.html" class="page">Vector Data</a></li>
  <li><a href="raster-processing.html" class="page">Raster Processing</a>
  <ul>
    <li><a href="local-algebra.html" class="page">Local Map Algebra</a></li>
    <li><a href="nodata-handling.html" class="active page">&ldquo;NoData&rdquo; Handling</a></li>
    <li><a href="masking.html" class="page">Masking</a></li>
    <li><a href="zonal-algebra.html" class="page">Zonal Map Algebra</a></li>
    <li><a href="aggregation.html" class="page">Aggregation</a></li>
    <li><a href="time-series.html" class="page">Time Series</a></li>
    <li><a href="raster-join.html" class="page">Raster Join</a></li>
  </ul></li>
  <li><a href="machine-learning.html" class="page">Machine Learning</a>
  <ul>
    <li><a href="unsupervised-learning.html" class="page">Unsupervised Machine Learning</a></li>
    <li><a href="supervised-learning.html" class="page">Supervised Machine Learning</a></li>
  </ul></li>
  <li><a href="numpy-pandas.html" class="page">NumPy and Pandas</a></li>
  <li><a href="ipython.html" class="page">IPython/Jupyter Extensions</a></li>
  <li><a href="languages.html" class="page">Scala and SQL</a></li>
  <li><a href="reference.html" class="page">Function Reference</a></li>
  <li><a href="release-notes.html" class="page">Release Notes</a></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="nodata-handling.html#handling" class="header">&ldquo;NoData&rdquo; Handling</a>
  <ul>
    <li><a href="nodata-handling.html#what-is-nodata-" class="header">What is NoData?</a></li>
    <li><a href="nodata-handling.html#cell-types" class="header">Cell Types</a></li>
    <li><a href="nodata-handling.html#nodata-and-local-arithmetic" class="header">NoData and Local Arithmetic</a></li>
    <li><a href="nodata-handling.html#changing-a-tiles-nodata-values" class="header">Changing a Tile&rsquo;s NoData Values</a></li>
    <li><a href="nodata-handling.html#combining-tiles-with-different-data-types" class="header">Combining Tiles with Different Data Types</a></li>
    <li><a href="nodata-handling.html#nodata-values-in-aggregation" class="header">NoData Values in Aggregation</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 0.9.1
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="nodata-handling.html#handling" class="header">&ldquo;NoData&rdquo; Handling</a>
  <ul>
    <li><a href="nodata-handling.html#what-is-nodata-" class="header">What is NoData?</a></li>
    <li><a href="nodata-handling.html#cell-types" class="header">Cell Types</a></li>
    <li><a href="nodata-handling.html#nodata-and-local-arithmetic" class="header">NoData and Local Arithmetic</a></li>
    <li><a href="nodata-handling.html#changing-a-tiles-nodata-values" class="header">Changing a Tile&rsquo;s NoData Values</a></li>
    <li><a href="nodata-handling.html#combining-tiles-with-different-data-types" class="header">Combining Tiles with Different Data Types</a></li>
    <li><a href="nodata-handling.html#nodata-values-in-aggregation" class="header">NoData Values in Aggregation</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#handling" name="handling" class="anchor"><span class="anchor-link"></span></a>&ldquo;NoData&rdquo; Handling</h1>
<h2><a href="#what-is-nodata-" name="what-is-nodata-" class="anchor"><span class="anchor-link"></span></a>What is NoData?</h2>
<p>In raster operations, the preservation and correct processing of missing observations is very important. In <a href="https://www.oreilly.com/learning/handling-missing-data">most DataFrames and in scientific computing</a>, the idea of missing data is expressed as a <code>null</code> or <code>NaN</code> value. However, a great deal of raster data is stored for space efficiency, which typically leads to use of integral values with a <a href="https://en.wikipedia.org/wiki/Sentinel_value">&ldquo;sentinel&rdquo; value</a> designated to represent missing observations. This sentinel value varies across data products and bands. In a generic sense, it is usually called the &ldquo;NoData&rdquo; value.</p>
<p>RasterFrames provides a variety of functions to inspect and manage NoData within <em>tiles</em>.</p>
<h2><a href="#cell-types" name="cell-types" class="anchor"><span class="anchor-link"></span></a>Cell Types</h2>
<p>To understand how NoData is handled in RasterFrames, we first need to understand the different underlying types of data called cell types. RasterFrames cell types are GeoTrellis <code>CellType</code>s, so the <a href="https://geotrellis.readthedocs.io/en/latest/guide/core-concepts.html?#working-with-cell-values">GeoTrellis documentation</a> is a valuable resource on how these are defined.</p>
<p>The <code>CellType</code> class from the <code>rf_types</code> submodule allows us to create a representation of any valid cell type. There are convenience methods to create instances for a variety of basic types.</p>
<pre class="prettyprint"><code class="language-python">from pyrasterframes.rf_types import CellType
CellType.bool()
CellType.int8()
CellType.uint8()
CellType.int16()
CellType.uint16()
CellType.int32()
CellType.float32()
CellType.float64()
</code></pre>
<p>We can also inspect the cell type of a given <em>tile</em> or <code>proj_raster</code> column.</p>
<pre class="prettyprint"><code class="language-python">cell_types = spark.read.raster(&#39;https://rasterframes.s3.amazonaws.com/samples/luray_snp/B02.tif&#39;) \
    .select(rf_cell_type(&#39;proj_raster&#39;)).distinct()
cell_types
</code></pre>
<table>
  <thead>
    <tr>
      <th>rf_cell_type(proj_raster) </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>[uint16raw] </td>
    </tr>
  </tbody>
</table>
<h3><a href="#understanding-cell-types-and-nodata" name="understanding-cell-types-and-nodata" class="anchor"><span class="anchor-link"></span></a>Understanding Cell Types and NoData</h3>
<p>We can use the methods on the <code>CellType</code> class to learn more about a specific cell type. Let&rsquo;s consider the cell type of our sample data above.</p>
<pre class="prettyprint"><code class="language-python">ct = CellType(&#39;uint16raw&#39;)
ct, ct.is_floating_point(), ct.has_no_data()
</code></pre>
<pre><code>(uint16raw, False, False)
</code></pre>
<p>We can see that for the above data source, there is no defined NoData value. This means that each value is interpreted as a valid observation. Often such data is meant to be combined with another band indicating the quality of observations at each location. The lack of NoData is indicated by the <code>raw</code> at the end of the type name. Consider for contrast the <code>uint16</code> cell type.</p>
<pre class="prettyprint"><code class="language-python">from pyrasterframes.rf_types import CellType
ct = CellType(&#39;uint16&#39;)
ct, ct.is_floating_point(), ct.has_no_data(), ct.no_data_value()
</code></pre>
<pre><code>(uint16, False, True, 0)
</code></pre>
<p>In this case, the minimum value of 0 is designated as the NoData value. For integral-valued cell types, the NoData is typically zero, the maximum, or the minimum value for the underlying data type. The NoData value can also be a user-defined value. In that case the value is designated with <code>ud</code>.</p>
<pre class="prettyprint"><code class="language-python">CellType.uint16().with_no_data_value(99).cell_type_name
</code></pre>
<pre><code>&#39;uint16ud99&#39;
</code></pre>
<p>Floating point types have <code>NaN</code> as the NoData value by default. However, a user-defined NoData can be set.</p>
<pre class="prettyprint"><code class="language-python">print(CellType.float32().no_data_value())
print(CellType.float32().with_no_data_value(-99.9).no_data_value())
</code></pre>
<pre><code>nan
-99.9
</code></pre>
<h2><a href="#nodata-and-local-arithmetic" name="nodata-and-local-arithmetic" class="anchor"><span class="anchor-link"></span></a>NoData and Local Arithmetic</h2>
<p>Let&rsquo;s now explore how the presence of NoData affects <a href="local-algebra.html">local map algebra</a> operations. To demonstrate the behavior, lets create two <em>tiles</em>. One <em>tile</em> will have values of 0 and 1, and the other will have values of just 0.</p>
<pre class="prettyprint"><code class="language-python">tile_size = 100
x = np.zeros((tile_size, tile_size), dtype=&#39;int16&#39;)
x[:,tile_size//2:] = 1
x = Tile(x)
y = Tile(np.zeros((tile_size, tile_size), dtype=&#39;int16&#39;))

rf = spark.createDataFrame([Row(x=x, y=y)])
print(&#39;x&#39;)
display(x)
</code></pre>
<pre><code>x
</code></pre>
<p><img src="data:image/png;base64,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" /><img src="figures/nodata-handling_local_arith_1.png" /></p>
<pre class="prettyprint"><code class="language-python">print(&#39;y&#39;)
display(y)
</code></pre>
<pre><code>y
/anaconda3/envs/rasterframes/lib/python3.7/site-packages/matplotlib/image.py:446: UserWarning: Warning: converting a masked element to nan.
  dv = np.float64(self.norm.vmax) - np.float64(self.norm.vmin)
/anaconda3/envs/rasterframes/lib/python3.7/site-packages/matplotlib/image.py:453: UserWarning: Warning: converting a masked element to nan.
  a_min = np.float64(newmin)
/anaconda3/envs/rasterframes/lib/python3.7/site-packages/matplotlib/image.py:458: UserWarning: Warning: converting a masked element to nan.
  a_max = np.float64(newmax)
/anaconda3/envs/rasterframes/lib/python3.7/site-packages/matplotlib/image.py:478: UserWarning: Warning: converting a masked element to nan.
  dtype=scaled_dtype)
</code></pre>
<p><img src="data:image/png;base64,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" /><img src="figures/nodata-handling_display_1_1.png" /></p>
<p>Now, let&rsquo;s create a new column from <code>x</code> with the value of 1 changed to NoData. Then, we will add this new column with NoData to the <code>y</code> column. As shown below, the result of the sum also has NoData (represented in white). In general for local algebra operations, Data + NoData = NoData.</p>
<pre class="prettyprint"><code class="language-python">masked_rf = rf.withColumn(&#39;x_nd&#39;, rf_mask_by_value(&#39;x&#39;, &#39;x&#39;, lit(1)) )
masked_rf = masked_rf.withColumn(&#39;x_nd_y_sum&#39;, rf_local_add(&#39;x_nd&#39;, &#39;y&#39;))
row = masked_rf.collect()[0]
print(&#39;x with NoData&#39;)
display(row.x_nd)
</code></pre>
<pre><code>x with NoData
</code></pre>
<p><img src="data:image/png;base64,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" /><img src="figures/nodata-handling_display_2_1.png" /></p>
<pre class="prettyprint"><code class="language-python">print(&#39;x with NoData plus y&#39;)
display(row.x_nd_y_sum)
</code></pre>
<pre><code>x with NoData plus y
</code></pre>
<p><img src="data:image/png;base64,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" /><img src="figures/nodata-handling_display_3_1.png" /> To see more information about possible operations on <em>tile</em> columns, see the <a href="local-algebra.html">local map algebra</a> page and <a href="reference.html#local-map-algebra">function reference</a>.</p>
<h2><a href="#changing-a-tiles-nodata-values" name="changing-a-tiles-nodata-values" class="anchor"><span class="anchor-link"></span></a>Changing a Tile&rsquo;s NoData Values</h2>
<p>One way to mask a <em>tile</em> is to make a new <em>tile</em> with a user defined NoData value. We will explore this method below. First, lets create a DataFrame from a <em>tile</em> with values of 0, 1, 2, and 3. We will use numpy to create a 100x100 <em>tile</em> with vertical bands containing values 0, 1, 2, and 3.</p>
<pre class="prettyprint"><code class="language-python">tile_size = 100
x = np.zeros((tile_size, tile_size), dtype=&#39;int16&#39;)

# setting the values of the columns
for i in range(4):
    x[:, i*tile_size//4:(i+1)*tile_size//4] = i
x = Tile(x)

rf = spark.createDataFrame([Row(tile=x)])
display(x)
</code></pre>
<p><img src="data:image/png;base64,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" /><img src="figures/nodata-handling_create_dummy_tile_1.png" alt="Dummy Tile" /></p>
<p>First, we mask the value of 1 by making a new <em>tile</em> column with the user defined cell type &lsquo;uint16ud1&rsquo;. Then, we mask out the value of two by making a <em>tile</em> column with the cell type &lsquo;uint16ud2&rsquo;.</p>
<pre class="prettyprint"><code class="language-python">def get_nodata_ct(nd_val):
	return CellType(&#39;uint16&#39;).with_no_data_value(nd_val)

masked_rf = rf.withColumn(&#39;tile_nd_1&#39;,
                           rf_convert_cell_type(&#39;tile&#39;, get_nodata_ct(1))) \
              .withColumn(&#39;tile_nd_2&#39;,
                          rf_convert_cell_type(&#39;tile_nd_1&#39;, get_nodata_ct(2))) \
</code></pre>
<pre class="prettyprint"><code class="language-python">collected = masked_rf.collect()
</code></pre>
<p>Let&rsquo;s look at the new <em>tiles</em> we created. The <em>tile</em> named <code>tile_nd_1</code> has the 1 values masked out as expected.</p>
<pre class="prettyprint"><code class="language-python">display(collected[0].tile_nd_1)
</code></pre>
<p><img src="data:image/png;base64,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" /><img src="figures/nodata-handling_display_4_1.png" /></p>
<p>And the <em>tile</em> named <code>tile_nd_2</code> has the values of 1 and 2 masked out. This is because we created the <em>tile</em> by setting a new user defined NoData value to <code>tile_nd_1</code>, and the values previously masked out in <code>tile_nd_1</code> stayed masked when creating <code>tile_nd_2</code>.</p>
<pre class="prettyprint"><code class="language-python">display(collected[0].tile_nd_2)
</code></pre>
<p><img src="data:image/png;base64,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" /><img src="figures/nodata-handling_display_5_1.png" /></p>
<h2><a href="#combining-tiles-with-different-data-types" name="combining-tiles-with-different-data-types" class="anchor"><span class="anchor-link"></span></a>Combining Tiles with Different Data Types</h2>
<p>RasterFrames supports having <em>tile</em> columns with different cell types in a single DataFrame. It is important to understand how these different cell types interact.</p>
<p>Let&rsquo;s first create a RasterFrame that has columns of <code>float</code> and <code>int</code> cell type.</p>
<pre class="prettyprint"><code class="language-python">x = Tile((np.ones((100, 100))*2), CellType.float64())
y = Tile((np.ones((100, 100))*3), CellType.int32())
rf = spark.createDataFrame([Row(x=x, y=y)])

cell_types = rf.select(rf_cell_type(&#39;x&#39;), rf_cell_type(&#39;y&#39;)).distinct()
cell_types
</code></pre>
<table>
  <thead>
    <tr>
      <th>rf_cell_type(x) </th>
      <th>rf_cell_type(y) </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>[float64] </td>
      <td>[int32] </td>
    </tr>
  </tbody>
</table>
<p>When performing a local operation between <em>tile</em> columns with cell types <code>int</code> and <code>float</code>, the resulting <em>tile</em> cell type will be <code>float</code>. In local algebra over two <em>tiles</em> of different &ldquo;sized&rdquo; cell types, the resulting cell type will be the larger of the two input <em>tiles&rsquo;</em> cell types.</p>
<pre class="prettyprint"><code class="language-python">sums = rf.select(
    rf_cell_type(&#39;x&#39;),
    rf_cell_type(&#39;y&#39;),
    rf_cell_type(rf_local_add(&#39;x&#39;, &#39;y&#39;)).alias(&#39;xy_sum&#39;),
    )
sums
</code></pre>
<table>
  <thead>
    <tr>
      <th>rf_cell_type(x) </th>
      <th>rf_cell_type(y) </th>
      <th>xy_sum </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>[float64] </td>
      <td>[int32] </td>
      <td>[float64] </td>
    </tr>
  </tbody>
</table>
<p>Combining <em>tile</em> columns of different cell types gets a little trickier when user defined NoData cell types are involved. Let&rsquo;s create two <em>tile</em> columns: one with a NoData value of 1, and one with a NoData value of 2 (using our previously defined <code>get_nodata_ct</code> function).</p>
<pre class="prettyprint"><code class="language-python">x_nd_1 = Tile((np.ones((100, 100))*3), get_nodata_ct(1))
x_nd_2 = Tile((np.ones((100, 100))*3), get_nodata_ct(2))
rf_nd = spark.createDataFrame([Row(x_nd_1=x_nd_1, x_nd_2=x_nd_2)])
</code></pre>
<p>Let&rsquo;s try adding the <em>tile</em> columns with different NoData values. When there is an inconsistent NoData value in the two columns, the NoData value of the right-hand side of the sum is kept. In this case, this means the result has a NoData value of 1.</p>
<pre class="prettyprint"><code class="language-python">rf_nd_sum = rf_nd.withColumn(&#39;x_nd_sum&#39;, rf_local_add(&#39;x_nd_2&#39;, &#39;x_nd_1&#39;))
cell_types = rf_nd_sum.select(rf_cell_type(&#39;x_nd_sum&#39;)).distinct()
cell_types
</code></pre>
<table>
  <thead>
    <tr>
      <th>rf_cell_type(x_nd_sum) </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>[uint16ud2] </td>
    </tr>
  </tbody>
</table>
<p>Reversing the order of the sum changes the NoData value of the resulting column to 2.</p>
<pre class="prettyprint"><code class="language-python">rf_nd_sum = rf_nd.withColumn(&#39;x_nd_sum&#39;, rf_local_add(&#39;x_nd_1&#39;, &#39;x_nd_2&#39;))
cell_types = rf_nd_sum.select(rf_cell_type(&#39;x_nd_sum&#39;)).distinct()
cell_types
</code></pre>
<table>
  <thead>
    <tr>
      <th>rf_cell_type(x_nd_sum) </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>[uint16ud1] </td>
    </tr>
  </tbody>
</table>
<h2><a href="#nodata-values-in-aggregation" name="nodata-values-in-aggregation" class="anchor"><span class="anchor-link"></span></a>NoData Values in Aggregation</h2>
<p>Let&rsquo;s use the same <em>tile</em> as before to demonstrate how NoData values affect <em>tile</em> aggregations.</p>
<pre class="prettyprint"><code class="language-python">tile_size = 100
x = np.zeros((tile_size, tile_size))
for i in range(4):
    x[:, i*tile_size//4:(i+1)*tile_size//4] = i
x = Tile(x, CellType.int16())

rf = spark.createDataFrame([Row(tile=x)])
display(x)
</code></pre>
<p><img src="data:image/png;base64,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" /><img src="figures/nodata-handling_display_6_1.png" /></p>
<p>First we create the two new masked <em>tile</em> columns as before. One with only the value of 1 masked, and the other with and values of 1 and 2 masked.</p>
<pre class="prettyprint"><code class="language-python">masked_rf = rf.withColumn(&#39;tile_nd_1&#39;,
                           rf_convert_cell_type(&#39;tile&#39;, get_nodata_ct(1))) \
              .withColumn(&#39;tile_nd_2&#39;,
                          rf_convert_cell_type(&#39;tile_nd_1&#39;, get_nodata_ct(2)))
</code></pre>
<p>The results of <code>rf_tile_sum</code> vary on the <em>tiles</em> that were masked. This is because any cells with NoData values are ignored in the aggregation. Note that <code>tile_nd_2</code> has the lowest sum, since it has the fewest amount of data cells.</p>
<pre class="prettyprint"><code class="language-python">sums = masked_rf.select(rf_tile_sum(&#39;tile&#39;), rf_tile_sum(&#39;tile_nd_1&#39;), rf_tile_sum(&#39;tile_nd_2&#39;))
sums
</code></pre>
<table>
  <thead>
    <tr>
      <th>rf_tile_sum(tile) </th>
      <th>rf_tile_sum(tile_nd_1) </th>
      <th>rf_tile_sum(tile_nd_2) </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>15000.0 </td>
      <td>12500.0 </td>
      <td>7500.0 </td>
    </tr>
  </tbody>
</table>
</div>
<div>
<a href="https://github.com/locationtech/rasterframes/tree/v0.9.1/pyrasterframes/target/python/docs/nodata-handling.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.9.1
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="local-algebra.html" title="Local Map Algebra" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Local Map Algebra
</span>
</div>
</a>
<a href="masking.html" title="Masking" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Masking
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
<div class="md-footer-copyright__highlight">
&copy; 2017-2019 <a href="https://astraea.earth">Astraea</a>, Inc. All rights reserved.
</div>
</div>
</div>
</div>
</footer>

</div>
<script src="assets/javascripts/application.583bbe55.js"></script>
<script src="assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"."}})</script>
<script type="text/javascript" src="lib/prettify/prettify.js"></script>
<script type="text/javascript" src="lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
<script>!function(e,a,t,n,o,c,i){e.GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),i=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",i.parentNode.insertBefore(c,i)}(window,document,"script",0,"ga"),ga("create","UA-106630615-1"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var a=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",a,e.href)})});if(document.forms.search){var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}</script>

</body>
</html>
